---
title: Subscriptions
---

Subscriptions are long-lived GraphQL read operations that can update their response over time, enabling clients to receive new data as it becomes available.

Apollo iOS 2.0 supports subscriptions over HTTP, using [chunked multipart responses](https://github.com/graphql/graphql-over-http/blob/main/rfcs/IncrementalDelivery.md)

<Note>
`ApolloWebSocket` support for 2.0 is coming soon. If you need to use web sockets, please continue using Apollo iOS 1.0 for now.
</Note>

**You must use whichever protocol is supported by your GraphQL endpoint.**

## Enabling support

To support GraphQL subscriptions, you need to initialize your `ApolloClient` instance with a [`NetworkTransport`](/ios/networking/client-creation#networktransport) that supports subscriptions.

The default `NetworkTransport` for Apollo iOS is the [`RequestChainNetworkTransport`](/ios/api/Apollo/classes/RequestChainNetworkTransport). This transport supports subscriptions over HTTP, with no additional configuration required.

If you are building a custom network transport and want to support subscriptions, you may use the provided `JSONResponseParser` for parsing multi-part response data.

## Generating and executing

Apollo iOS supports subscriptions via [code generation](../code-generation/introduction/). Similar to queries, subscriptions are represented by instances of generated classes, conforming to the `GraphQLSubscription` protocol.

```graphql title="ReviewAddedSubscription.graphql"
subscription ReviewAdded {
  reviewAdded {
    id
    stars
  }
}
```

After you generate these classes, you can execute subscriptions using `ApolloClient.subscribe(subscription:)` with a [subscription-supporting `NetworkTransport`](#enabling-support). If you do, your client continues to receive updated data until the subscription is [canceled](#canceling-a-subscription) or is terminated by the server.

```swift
let subscription = try await client.subscribe(subscription: ReviewAddedSubscription())

Task {
  for try await result in subscription {
    // Handle each update from the subscription.
  }
}
```

> **Note:** GraphQL subscriptions are distinct from [watching queries](./queries#watching-queries). A query watcher is only updated when new data is written to the local cache (usually by another network operation). A GraphQL subscription is a long-lived request that might receive updated data from the server continually.

## Canceling a subscription

Apollo iOS 2.0 participates in Swift structured concurrency task cancellation for subscription cancellation.
To cancel a subscription, you cancel the `Task` that the subscription was initiated in.

When a task is cancelled, the subscription's `AsyncThrowingStream` will terminate gracefully and the connection to the server will be closed.

```swift
class ReviewViewController {

  let client: ApolloClient!
  private var subscriptionTask: Task<Void, Never>?

  func subscribeToReviews() {
    // Keep a reference to the subscription task
    self.subscriptionTask = Task {
      do {
        let subscription = try await client.subscribe(subscription: ReviewAddedSubscription())

        for try await result in subscription {
          // Handle each update from the subscription
          print("Received subscription update: \(result.data)")
        }
      } catch {
        print("Subscription error: \(error)")
      }
    }
  }

  deinit {
    // Cancel the subscription task when this object is deallocated
    self.subscriptionTask?.cancel()
  }
}
```
